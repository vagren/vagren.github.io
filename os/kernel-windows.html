<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Windows Kernel | WebCourse</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.49eed234.css">
    <link rel="modulepreload" href="/assets/Home.e02e0cd4.js">
    <link rel="modulepreload" href="/assets/app.79b189f8.js">
    <link rel="modulepreload" href="/assets/os_kernel-windows.md.95305664.lean.js">
    
    <meta name="twitter:title" content="Windows Kernel | WebCourse">
  <meta property="og:title" content="Windows Kernel | WebCourse">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="WebCourse, back to home" data-v-675d8756 data-v-cc01ef16><!----> WebCourse</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><!----></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><!----><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#kernel-内核">Kernel 内核</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#linux-的设计">Linux 的设计</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#mutitask">MutiTask</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#smp-对称多处理">SMP 对称多处理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#elf-可执行文件链接格式">ELF 可执行文件链接格式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#monolitick-kernel-宏内核">Monolitick Kernel 宏内核</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#windows-设计">Windows 设计</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#windows-nt引入的新概念">Windows NT引入的新概念</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ntfs-windows-nt-file-system">NTFS - Windows NT File System</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="windows-kernel" tabindex="-1">Windows Kernel <a class="header-anchor" href="#windows-kernel" aria-hidden="true">#</a></h1><blockquote><p><a href="https://www.zhihu.com/question/355224746/answer/1816550573" target="_blank" rel="noopener noreferrer">Windows 内核和 Linux 内核谁更复杂?</a></p></blockquote><h2 id="kernel-内核" tabindex="-1">Kernel 内核 <a class="header-anchor" href="#kernel-内核" aria-hidden="true">#</a></h2><img src="/assets/os.a11baa2c.jpg" alt="img" style="zoom:67%;"><p>计算机是由各种外部硬件设备组成的，比如内存、cpu、硬盘等，如果每个应用都要和这些硬件设备对接通信协议，那这样太累了，所以这个中间人就由内核来负责，<strong>让内核作为应用连接硬件设备的桥梁</strong>，应用程序只需关心与内核交互，不用关心硬件的细节。</p><p>现代操作系统，内核一般会提供 4 个特性：</p><ul><li>管理进程、线程，进程调度；</li><li>管理内存，决定内存的分配和回收；</li><li>管理硬件设备，为进程与硬件设备之间提供通信能力；</li><li>提供系统调用，如果应用程序要运行更高权限运行的服务，那么就需要有系统调用，它是用户程序与<a href="https://www.zhihu.com/search?q=%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1816550573%7D" target="_blank" rel="noopener noreferrer">操作系统</a>之间的接口。</li></ul><p>内核权限很高，可以控制CPU、内存、硬盘等硬件，而应用程序具有的权限很小，因此大多数操作系统，把内存分配成了两个区域：</p><ul><li>内核空间，这个内存空间只有内核线程可以访问；</li><li>用户空间，这个内存空间专门给应用程序访问；</li></ul><p>用户空间的代码只能访问一个局部的内存空间，而内核空间的代码可以访问所有内存空间。因此，当程序使用用户空间时，我们常说该程序在<strong>用户态</strong>执行，而当程序使内核空间时，程序则在<strong>内核态</strong>执行。</p><p>应用程序如果需要进入内核空间，就需要通过系统调用，下面来看看系统调用的过程：</p><p><img src="/assets/system-call.ca3cf95a.jpg" alt="img"></p><p><a href="https://www.zhihu.com/search?q=%E5%86%85%E6%A0%B8%E7%A8%8B%E5%BA%8F&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1816550573%7D" target="_blank" rel="noopener noreferrer">内核程序</a>执行在内核态，用户程序执行在用户态。当应用程序使用系统调用时，会产生一个中断。发生中断后， CPU 会中断当前在执行的用户程序，转而跳转到中断处理程序，也就是开始执行内核程序。内核处理完后，主动触发中断，把 CPU 执行权限交回给用户程序，回到用户态继续工作。</p><h2 id="linux-的设计" tabindex="-1">Linux 的设计 <a class="header-anchor" href="#linux-的设计" aria-hidden="true">#</a></h2><p>Linux 的开山始祖是来自一位名叫 Linus Torvalds 的芬兰小伙子，他在 1991 年用 C 语言写出了第一版的 Linux 操作系统，那年他 22 岁。</p><p>Linux 内核设计的理念主要有这几个点：</p><ul><li>MutTask, 多任务</li><li>SMP 对称多处理</li><li>ELF 可执行文件链接格式</li><li>Monolitick Kernel 宏内核</li></ul><h3 id="mutitask" tabindex="-1">MutiTask <a class="header-anchor" href="#mutitask" aria-hidden="true">#</a></h3><p>多任务意味着可以有多个任务同时执行，这里的「同时」可以是并发或并行：</p><ul><li>对于单核 CPU 时，可以让每个任务执行一小段时间，时间到就切换另外一个任务，从宏观角度看，一段时间内执行了多个任务，这被称为并发。</li><li>对于多核 CPU 时，多个任务可以同时被不同核心的 CPU 同时执行，这被称为并行。</li></ul><h3 id="smp-对称多处理" tabindex="-1">SMP 对称多处理 <a class="header-anchor" href="#smp-对称多处理" aria-hidden="true">#</a></h3><p>SMP 的意思是<strong>对称多处理</strong>，代表着每个 CPU 的地位是相等的，对资源的使用权限也是相同的，多个 CPU 共享同一个内存，每个 CPU 都可以访问完整的内存和硬件资源。</p><p>这个特点决定了 Linux 操作系统不会有某个 CPU 单独服务<a href="https://www.zhihu.com/search?q=%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1816550573%7D" target="_blank" rel="noopener noreferrer">应用程序</a>或内核程序，而是每个程序都可以被分配到任意一个 CPU 上被执行。</p><h3 id="elf-可执行文件链接格式" tabindex="-1">ELF 可执行文件链接格式 <a class="header-anchor" href="#elf-可执行文件链接格式" aria-hidden="true">#</a></h3><p>ELF 的意思是<strong>可执行文件链接格式</strong>，它是 Linux 操作系统中可执行文件的存储格式，你可以从下图看到它的结构：</p><img src="/assets/linux-elf.52773dc4.jpg" alt="img" style="zoom:67%;"><p>ELF 把文件分成了一个个分段，每一个段都有自己的作用，感兴趣的同学可以去看《程序员的自我修养——链接、装载和库》这本书。</p><p>ELF 文件有两种索引</p><ul><li>Program header table 中记录了「运行时」所需的段;</li><li>Section header table 记录了<a href="https://www.zhihu.com/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1816550573%7D" target="_blank" rel="noopener noreferrer">二进制文件</a>中各个「段的首地址」;</li></ul><h3 id="monolitick-kernel-宏内核" tabindex="-1">Monolitick Kernel 宏内核 <a class="header-anchor" href="#monolitick-kernel-宏内核" aria-hidden="true">#</a></h3><p><img src="/assets/kernels.4a23b898.jpg" alt="preview"></p><ul><li><p>宏内核，包含多个模块，整个内核像一个完整的程序；</p></li><li><p>微内核，有一个最小版本的内核，一些模块和服务则由用户态管理；</p><ul><li>宏内核缺点： <ul><li>稳定性差：当内核中某个模块崩溃了，整个内核就会崩溃。</li><li>扩展性差：在内核中添加新的功能，就需要各个模块进行修改。</li></ul></li><li>华为的鸿蒙操作系统的内核架构就是微内核</li></ul></li><li><p>混合内核，是宏内核和微内核的结合体，内核中抽象出了微内核的概念，也就是内核中会有一个小型的内核，其他模块就在这个基础上搭建，整个内核是个完整的程序；</p></li></ul><p>Linux 的内核设计是采用了宏内核，<strong>Window 的内核设计则是采用了混合内核</strong>。</p><h2 id="windows-设计" tabindex="-1">Windows 设计 <a class="header-anchor" href="#windows-设计" aria-hidden="true">#</a></h2><p>Windows 7、Windows 10 使用的内核叫 Windows NT，NT 全称叫 <strong>New Technology</strong>。</p><p>Windows NT 的结构图片</p><p><img src="/assets/kernel-windows.7a498024.jpg" alt="img"></p><p>Windows 的可执行文件的格式与 Linux 也不同，所以这两个系统的可执行文件是不可以在对方上运行的。</p><p>Windows 的可执行文件格式叫 PE，称为<strong>可移植执行文件</strong>，扩展名通常是<code>.exe</code>、<code>.dll</code>、<code>.sys</code>等。</p><p>PE 的结构你可以从下图中看到，它与 ELF 结构有一点相似。</p><p><img src="/assets/windows-pe.7e5ab3b1.jpg" alt="img"></p><table><thead><tr><th></th><th>Windows Version</th><th>NT Version</th><th></th></tr></thead><tbody><tr><td></td><td>Windows 1.0/2.0/3.0/3.1/95/98/ME</td><td></td><td></td></tr><tr><td></td><td>Windows XP</td><td>NT5.1</td><td></td></tr><tr><td></td><td>2003</td><td>NT5.2</td><td></td></tr><tr><td></td><td>Vista</td><td>NT6.0</td><td></td></tr><tr><td></td><td>7</td><td>NT6.1</td><td></td></tr><tr><td></td><td>8</td><td>NT6.x</td><td></td></tr><tr><td></td><td>8.1</td><td>NT6.x</td><td></td></tr><tr><td></td><td>10</td><td>NT10.x</td><td></td></tr><tr><td></td><td>11</td><td>10.x</td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h3 id="windows-nt引入的新概念" tabindex="-1">Windows NT引入的新概念 <a class="header-anchor" href="#windows-nt引入的新概念" aria-hidden="true">#</a></h3><ul><li>NTFS - Windows NT File System</li><li>共享 Share</li><li>用户账户 User Account</li><li>域 Domain</li><li>工作群组 Workgroup</li><li>权利 Right</li><li>权限 Permission</li><li>安全审计</li></ul><h3 id="ntfs-windows-nt-file-system" tabindex="-1">NTFS - Windows NT File System <a class="header-anchor" href="#ntfs-windows-nt-file-system" aria-hidden="true">#</a></h3></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"base_angular_index.md\":\"b7fb98d8\",\"base_aot_aot.md\":\"c43520f0\",\"base_babel_advanced.md\":\"63d342bd\",\"base_babel_babel.md\":\"08db37cd\",\"base_babel_index.md\":\"7eeed92e\",\"base_c_index.md\":\"b4d74b36\",\"base_centos_index.md\":\"a9a38139\",\"base_chrome.google_chrome.md\":\"9ab68b28\",\"base_chrome_chrome.md\":\"d5478063\",\"base_css_css.md\":\"53cfe2c2\",\"base_docker_index.md\":\"ce74c680\",\"base_eclipse_index.md\":\"237a2a6a\",\"base_element_index.md\":\"89357051\",\"base_eslint_ellint.md\":\"ed5245f3\",\"base_git_git.md\":\"94bdb8c9\",\"base_git_index.md\":\"0703fa56\",\"base_gitee_gitee.md\":\"cab28a11\",\"base_index.md\":\"2c3d9022\",\"base_javascript_index.md\":\"763b15a0\",\"base_jenkins_index.md\":\"4f161285\",\"base_k8s_changelog.md\":\"b3602f66\",\"base_k8s_index.md\":\"7566b1e3\",\"base_lerna_index.md\":\"c101cd05\",\"base_linux_desktop-environment_desktop-environment.md\":\"e98166a4\",\"base_linux_distribution_fedora_fedora.md\":\"27cd3611\",\"base_linux_distribution_deepin_deepin.md\":\"6d619bd8\",\"base_linux_distribution_release-linux.md\":\"b9f41044\",\"base_linux_index.md\":\"3b9628c0\",\"base_linux_linux运维管理.md\":\"131c0685\",\"base_markdown_markdown.md\":\"d0c50375\",\"base_node_index.md\":\"82ac46bf\",\"base_node_package.json.md\":\"5dcd94a1\",\"base_npm_index.md\":\"77335796\",\"base_pnpm_index.md\":\"3720ecc2\",\"base_rancher_rancher_v1.x.md\":\"737d5024\",\"base_sprint_sprintboot_index.md\":\"a3803d2f\",\"base_typescript_typescript 2.md\":\"5c9d9fc7\",\"base_typescript_typescript.md\":\"2107d092\",\"base_v8_index.md\":\"ff3988a2\",\"base_vite_index.md\":\"8c652462\",\"base_vite_vite.md\":\"2a219f01\",\"base_vitepress_index.md\":\"1d84b7f6\",\"base_vscode_configuration.md\":\"0544a770\",\"base_vscode_devextension.md\":\"943eea8d\",\"base_vscode_index.md\":\"fd79141e\",\"base_vscode_index的副本.md\":\"c01426cf\",\"base_vscode_setting.vscode.wit.md\":\"e7d097ce\",\"base_vscode_vscode.md\":\"dbf5c04b\",\"base_vue_cli.md\":\"887006a7\",\"base_vue_compile 2.md\":\"abcbe179\",\"base_vue_compile.md\":\"3bc59f4f\",\"base_vue_composition-api-vue2.md\":\"e7ddbfa4\",\"base_vue_index 2.md\":\"7a06bd7b\",\"base_vue_index.md\":\"f58fe564\",\"base_vue_rule 2.md\":\"d05982e0\",\"base_vue_rule.md\":\"50c0dde7\",\"base_vue_vuecli_index.md\":\"f17a3bc1\",\"base_vuecli_index.md\":\"141ebc83\",\"base_wechat_index.md\":\"9feec7b6\",\"base_windows_window.md\":\"8a580416\",\"base_windows_windows.md\":\"5dbcbfed\",\"base_winget_index.md\":\"85597476\",\"base_winget_package.json.md\":\"494751ea\",\"base_yarn_index.md\":\"169d3711\",\"data_常用算法.md\":\"fb437b77\",\"data_数据结构.md\":\"f105a4dc\",\"data_算法题.md\":\"e7f551f0\",\"economics_daikuan.md\":\"5fbc18c8\",\"hardware_car_jeep_index.md\":\"d5c72757\",\"hardware_earphone_index.md\":\"2712d9ac\",\"hardware_index.md\":\"9a014f54\",\"hardware_ipad.md\":\"bd7dc48e\",\"hardware_keyboard_index.md\":\"5a8e9df6\",\"hardware_pc.md\":\"f80bac39\",\"hardware_phone.md\":\"1f8b0565\",\"hardware_人体工学椅.md\":\"3663023d\",\"hardware_接口.md\":\"1941bec4\",\"index.md\":\"129099ac\",\"movies_index.md\":\"4df168f8\",\"net_56_109.md\":\"a1402b78\",\"net_56_110.md\":\"11434ea4\",\"net_56_index.md\":\"7d8e261d\",\"net_netprotocal_http_index.md\":\"f374b289\",\"net_netprotocal_http2_index.md\":\"a743506a\",\"net_netprotocal_index.md\":\"29fe4819\",\"net_browser_index.md\":\"356857d9\",\"net_domains_index.md\":\"2b1ab77b\",\"net_gfw.md\":\"4ac408c0\",\"net_index 2.md\":\"03d74029\",\"net_index.md\":\"bf0e58ce\",\"net_监控_index.md\":\"c87f8a3c\",\"net_监控_前端监控 sdk 的一些技术要点原理分析.md\":\"94fb4204\",\"net_监控_前端监控平台系列：js sdk（已开源）.md\":\"994dd3cf\",\"net_监控_前端监控平台系列：服务端功能设计与实现.md\":\"ecf7f010\",\"net_网络协议_index.md\":\"d81eebe7\",\"net_路由器_路由器.md\":\"7b473456\",\"os_filesystem.md\":\"94224199\",\"os_cardos_index.md\":\"6a54979f\",\"os_kernel-windows.md\":\"95305664\",\"os_uos_index.md\":\"b24fb656\",\"os_windows_windows-kernel_filesystem-windows.md\":\"e781039b\",\"os_windows_windows-kernel_powershell.md\":\"087cf6fd\",\"os_windows_windows-kernel_tools-windows.md\":\"879becc1\",\"os_windows_windows-kernel_windows.md\":\"74542254\",\"os_windows_windows-kernel_垃圾清理.md\":\"a61d7f0f\",\"software_a-tools.md\":\"2d8b3a4d\",\"software_browser_index.md\":\"4c792ac1\",\"software_download-tools.md\":\"6b3fce1a\",\"software_index.md\":\"e824bbad\",\"software_news21-05.hardware.md\":\"92971134\",\"software_news21.software.md\":\"3f581dd7\",\"todos_index.md\":\"e0ca8b4d\",\"topic_bigdata_index.md\":\"853970c5\",\"topic_container_index.md\":\"c6882023\",\"topic_data-visualization_139_03.md\":\"9e00128a\",\"topic_data-visualization_139_04.md\":\"edf7c329\",\"topic_data-visualization_139_05.md\":\"dba3a698\",\"topic_data-visualization_139_06.md\":\"05c7bb98\",\"topic_data-visualization_139_index.md\":\"b190bfca\",\"topic_data-visualization_index.md\":\"8596728a\",\"topic_frontend_components_login.md\":\"1ff239d9\",\"topic_frontend_components_scrollbar_scrollbar.md\":\"fe6a3423\",\"topic_frontend_components_tree-select_index.md\":\"14f8be1f\",\"topic_frontend_index.md\":\"4165fd0f\",\"topic_frontend_portal_index.md\":\"cf51fc78\",\"topic_frontend_router_index.md\":\"2e57383b\",\"topic_frontend_router_router.md\":\"9eca97ed\",\"topic_frontend_template_template.md\":\"2beacd66\",\"topic_frontend_vscode_index.md\":\"86357607\",\"topic_frontend_数据埋点规范.md\":\"b85ad9fd\",\"topic_frontend_登录鉴权_index.md\":\"32a01b9a\",\"topic_frontend_跨端方案_index.md\":\"ae827069\",\"topic_index.md\":\"861e0c40\",\"topic_leader.md\":\"f3195180\",\"topic_license_license.md\":\"2f02a5af\",\"topic_manamge.md\":\"e983891f\",\"topic_materials-vue2_index.md\":\"b407d3d6\",\"topic_micro-soa_index.md\":\"e4d81f9b\",\"topic_programming-paradigm_programming-paradigm.md\":\"691bf1b6\",\"topic_tdd_index.md\":\"88a3a084\",\"topic_tree-shaking_index.md\":\"a8562cf8\",\"topic_webadmin_index.md\":\"e8e6b04f\",\"topic_哲学_国学.md\":\"0123d402\",\"topic_计算机编码_计算机编码.md\":\"dc832859\"}")</script>
    <script type="module" async src="/assets/app.79b189f8.js"></script>
    
  </body>
</html>